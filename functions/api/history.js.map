{"version":3,"sources":["../../backend/api/history.js"],"names":["express","require","router","Router","query","authenticated","get","admin","req","res","next","from","to","queryString","result","send","rows","module","exports"],"mappings":";;;;;;;;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;AAAA,IACEC,MAAM,GAAGF,OAAO,CAACG,MAAR,EADX;;AAEA,IAAMC,KAAK,GAAGH,OAAO,CAAC,OAAD,CAArB;;AACA,IAAMI,aAAa,GAAGJ,OAAO,CAAC,8BAAD,CAA7B;;AAEAC,MAAM,CAACI,GAAP,CAAW,GAAX,EAAgBD,aAAa,CAACE,KAA9B;AAAA,qFAAqC,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAEZF,GAAG,CAACJ,KAFQ,EAEzBO,IAFyB,cAEzBA,IAFyB,EAEnBC,EAFmB,cAEnBA,EAFmB;AAG3BC,YAAAA,WAH2B,gKAS/BF,IAAI,IAAIC,EAAR,GAAa,oCAAb,GAAoD,EATrB;AAAA;AAAA,mBAWZR,KAAK,CAACS,WAAD,EAAc,CAACF,IAAD,EAAOC,EAAP,CAAd,CAXO;;AAAA;AAW3BE,YAAAA,MAX2B;AAYjCL,YAAAA,GAAG,CAACM,IAAJ,CAASD,MAAM,CAACE,IAAhB;AAZiC;AAAA;;AAAA;AAAA;AAAA;AAcjCN,YAAAA,IAAI,aAAJ;;AAdiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAArC;;AAAA;AAAA;AAAA;AAAA;AAkBAO,MAAM,CAACC,OAAP,GAAiBhB,MAAjB","sourcesContent":["const express = require('express'),\n  router = express.Router()\nconst query = require('../db')\nconst authenticated = require('../middlewares/authenticated')\n\nrouter.get('/', authenticated.admin, async (req, res, next) => {\n  try {\n    const { from, to } = req.query\n    const queryString = `\n    SELECT h.*, d.building_id\n    FROM history h\n    INNER JOIN doorbells d\n    ON h.doorbell_special_id = d.special_id\n    WHERE 1 = 1\n    ${from && to ? 'AND completed_at BETWEEN $1 AND $2' : ''}\n  `\n    const result = await query(queryString, [from, to])\n    res.send(result.rows)\n  } catch (err) {\n    next(err)\n  }\n})\n\nmodule.exports = router\n"],"file":"history.js"}