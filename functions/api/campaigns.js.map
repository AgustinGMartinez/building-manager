{"version":3,"sources":["../../backend/api/campaigns.js"],"names":["Joi","require","express","router","Router","query","CustomError","authenticated","validateCampaign","campaigns","schema","name","string","required","validate","error","get","admin","req","res","campaignsQuery","send","rows","post","next","body","checkUniqueNameQuery","result","length","delete","id","params","module","exports"],"mappings":"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","sourcesContent":["const Joi = require('joi')\nconst express = require('express'),\n  router = express.Router()\nconst query = require('../db')\nconst CustomError = require('../errors')\nconst authenticated = require('../middlewares/authenticated')\n\nfunction validateCampaign(campaigns) {\n  const schema = {\n    name: Joi.string().required(),\n  }\n  const { error } = Joi.validate(campaigns, schema)\n  if (error) {\n    throw new CustomError(400, error)\n  }\n}\n\nrouter.get('/', authenticated.admin, async (req, res) => {\n  const campaignsQuery = `\n  SELECT *\n  FROM campaigns\n  `\n  const campaigns = await query(campaignsQuery)\n  res.send(campaigns.rows)\n})\n\nrouter.post('/', authenticated.admin, async (req, res, next) => {\n  try {\n    validateCampaign(req.body)\n    const { name } = req.body\n    const checkUniqueNameQuery = `\n      SELECT * from campaigns where name = $1\n    `\n    const result = await query(checkUniqueNameQuery, [name])\n    if (result.rows.length) {\n      return next(new CustomError(400, 'Ya existe una campaÃ±a con ese nombre'))\n    }\n    await query(\n      `\n      INSERT INTO campaigns (name) VALUES ($1)\n      `,\n      [name],\n    )\n    res.send()\n  } catch (err) {\n    next(err)\n  }\n})\n\nrouter.delete('/:id', authenticated.admin, async (req, res, next) => {\n  try {\n    const { id } = req.params\n    await query(\n      `\n      DELETE FROM campaigns WHERE id = $1\n      `,\n      [id],\n    )\n    res.send()\n  } catch (err) {\n    next(err)\n  }\n})\n\nmodule.exports = router\n"],"file":"campaigns.js"}