{"version":3,"sources":["../../backend/db/index.js"],"names":["functions","require","Pool","CustomError","removeUndefined","connectionPool","host","config","db","user","password","database","port","max","ssl","query","parameters","Promise","resolve","reject","err","result","console","log","message","module","exports"],"mappings":";;AAAA,IAAMA,SAAS,GAAGC,OAAO,CAAC,oBAAD,CAAzB;;eACiBA,OAAO,CAAC,IAAD,C;IAAhBC,I,YAAAA,I;;AACR,IAAMC,WAAW,GAAGF,OAAO,CAAC,WAAD,CAA3B;;AACA,IAAMG,eAAe,GAAGH,OAAO,CAAC,iBAAD,CAAP,CAA2BG,eAAnD;;AAEA,IAAMC,cAAc,GAAG,IAAIH,IAAJ,CAAS;AAC9BI,EAAAA,IAAI,EAAEN,SAAS,CAACO,MAAV,GAAmBC,EAAnB,CAAsBF,IADE;AAE9BG,EAAAA,IAAI,EAAET,SAAS,CAACO,MAAV,GAAmBC,EAAnB,CAAsBC,IAFE;AAG9BC,EAAAA,QAAQ,EAAEV,SAAS,CAACO,MAAV,GAAmBC,EAAnB,CAAsBE,QAHF;AAI9BC,EAAAA,QAAQ,EAAEX,SAAS,CAACO,MAAV,GAAmBC,EAAnB,CAAsBG,QAJF;AAK9BC,EAAAA,IAAI,EAAE,IALwB;AAM9BC,EAAAA,GAAG,EAAE,EANyB;AAO9BC,EAAAA,GAAG,EAAE;AAPyB,CAAT,CAAvB;;AAUA,SAASC,KAAT,CAAeA,KAAf,EAAyC;AAAA,MAAnBC,UAAmB,uEAAN,IAAM;AACvC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCd,IAAAA,cAAc,CAACU,KAAf,CAAqBA,KAArB,EAA4BX,eAAe,CAACY,UAAD,CAA3C,EAAyD,UAACI,GAAD,EAAMC,MAAN,EAAiB;AACxE,UAAID,GAAJ,EAAS;AACPE,QAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACAD,QAAAA,MAAM,CAAC,IAAIhB,WAAJ,CAAgB,GAAhB,EAAqB,qBAAqBiB,GAAG,CAACI,OAA9C,CAAD,CAAN;AACD;;AACDN,MAAAA,OAAO,CAACG,MAAD,CAAP;AACD,KAND;AAOD,GARM,CAAP;AASD;;AAEDI,MAAM,CAACC,OAAP,GAAiBX,KAAjB","sourcesContent":["const functions = require('firebase-functions')\nconst { Pool } = require('pg')\nconst CustomError = require('../errors')\nconst removeUndefined = require('../utils/arrays').removeUndefined\n\nconst connectionPool = new Pool({\n  host: functions.config().db.host,\n  user: functions.config().db.user,\n  password: functions.config().db.password,\n  database: functions.config().db.database,\n  port: 5432,\n  max: 20,\n  ssl: true,\n})\n\nfunction query(query, parameters = null) {\n  return new Promise((resolve, reject) => {\n    connectionPool.query(query, removeUndefined(parameters), (err, result) => {\n      if (err) {\n        console.log(err)\n        reject(new CustomError(500, 'DB query error: ' + err.message))\n      }\n      resolve(result)\n    })\n  })\n}\n\nmodule.exports = query\n"],"file":"index.js"}